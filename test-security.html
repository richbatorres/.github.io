<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Security Test</title>
<style>
body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; background: #f5f5f5; }
h1 { color: #333; }
.test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.test-item { padding: 10px; margin: 10px 0; border-left: 4px solid #ccc; background: #f9f9f9; }
.test-item.pass { border-color: #4caf50; background: #e8f5e9; }
.test-item.fail { border-color: #f44336; background: #ffebee; }
button { background: #c9a752; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
button:hover { background: #b8964a; }
#summary { font-size: 18px; font-weight: bold; margin: 20px 0; padding: 15px; background: #e3f2fd; border-radius: 6px; }
</style>
</head>
<body>

<h1>Security Test Suite</h1>

<div class="test-section">
  <h2>Test Controls</h2>
  <button onclick="runAllTests()">Run All Tests</button>
  <button onclick="clearResults()">Clear Results</button>
</div>

<div id="summary"></div>

<div class="test-section">
  <h2>Test Results</h2>
  <div id="results"></div>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxxpHO8vjFa-9op2_Hdbm46cfDR5Mm-tfeKghGJTmKm7WYJ2RZQXdwL7ASrEibmsXmA/exec';

const tests = [
  { name: 'Valid Request', data: { guests: ['Marko Markovic'], notes: 'Test', timestamp: new Date().toISOString(), website: '' } },
  { name: 'Empty Guests', data: { guests: [], notes: 'Test', timestamp: new Date().toISOString(), website: '' } },
  { name: 'Too Many Guests', data: { guests: Array(11).fill('Guest'), notes: 'Test', timestamp: new Date().toISOString(), website: '' } },
  { name: 'Name Too Long', data: { guests: ['A'.repeat(101)], notes: 'Test', timestamp: new Date().toISOString(), website: '' } },
  { name: 'Honeypot Filled', data: { guests: ['Bot'], notes: 'Test', timestamp: new Date().toISOString(), website: 'spam' } },
  { name: 'Old Timestamp', data: { guests: ['Test'], notes: 'Test', timestamp: new Date(Date.now() - 6 * 60 * 1000).toISOString(), website: '' } }
];

let testResults = [];

async function runTest(test, index) {
  const resultDiv = document.getElementById('test-' + index);
  resultDiv.textContent = 'Testing...';
  
  try {
    await fetch(SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(test.data)
    });
    
    testResults.push({ test: test.name, status: 'SENT' });
    resultDiv.className = 'test-item pass';
    resultDiv.textContent = test.name + ' - SENT';
  } catch (error) {
    testResults.push({ test: test.name, status: 'ERROR' });
    resultDiv.className = 'test-item fail';
    resultDiv.textContent = test.name + ' - ERROR: ' + error.message;
  }
}

async function runAllTests() {
  testResults = [];
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';
  
  tests.forEach((test, index) => {
    const testDiv = document.createElement('div');
    testDiv.id = 'test-' + index;
    testDiv.className = 'test-item';
    testDiv.textContent = test.name + ' - Waiting...';
    resultsDiv.appendChild(testDiv);
  });
  
  for (let i = 0; i < tests.length; i++) {
    await runTest(tests[i], i);
    await new Promise(resolve => setTimeout(resolve, 2000));
  }
  
  updateSummary();
}

function updateSummary() {
  const summaryDiv = document.getElementById('summary');
  const total = testResults.length;
  const sent = testResults.filter(r => r.status === 'SENT').length;
  const errors = testResults.filter(r => r.status === 'ERROR').length;
  
  summaryDiv.innerHTML = 'Total: ' + total + ' | Sent: ' + sent + ' | Errors: ' + errors + '<br><br>Check Google Sheets to verify which requests were accepted/rejected.';
}

function clearResults() {
  document.getElementById('results').innerHTML = '';
  document.getElementById('summary').innerHTML = '';
  testResults = [];
}
</script>

</body>
</html>
